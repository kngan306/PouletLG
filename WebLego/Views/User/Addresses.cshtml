@model List<WebLego.Models.ViewModel.AddressViewModel>
@{
    ViewData["Title"] = "Địa chỉ giao hàng";
}

<link href="~/css/profile.css" rel="stylesheet" />

<style>
    .address-layout {
        background-color: rgba(245, 245, 245, 1);
        margin-top: 40px;
        margin-left: 15px;
        max-width: 1440px;
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: stretch;
        overflow: hidden;
    }

    .page-container {
        display: flex;
        max-width: 1440px;
        width: 100%;
        flex-direction: column;
        align-items: stretch;
    }

    .header-row {
        display: flex;
        flex-direction: row;
        align-items: center;
        width: 100%;
        justify-content: space-between;
        /* margin-bottom: 10px; */
    }

    .address-title {
        color: rgba(0, 0, 0, 1);
        font-size: 20px;
        font-weight: 600;
        margin: 0 20px 10px 0;
        flex-grow: 0;
    }

    .content-wrapper {
        display: flex;
        justify-content: space-between;
        margin-top: 15px;
        width: 100%;
    }

    .sidebar-wrapper {
        width: 300px;
        margin-right: 20px;
    }

    .address-content {
        width: calc(100% - 320px);
        padding: 0 20px;
        box-sizing: border-box;
    }

    .card {
        border-radius: 12px;
        background-color: #fff;
        border: 2px solid rgba(65, 65, 65, 0.09);
        margin-bottom: 1rem;
    }

    .btn-add-new-address {
        font-size: 15px;
        border: none;
        border-radius: 10px;
        font-weight: 500;
        background-color: #FECC29;
        color: black;
        text-align: center;
        flex-shrink: 0;
        padding: 0.5rem 1rem;
    }

    .btn-add-new-address:hover {
            background-color: #E0B522;
            color: black;
    }

    .btn-outline-primary, .btn-outline-danger {
        border: 1px solid;
        padding: 0.25rem 0.5rem;
        font-size: 0.875rem;
    }

    .badge {
        padding: 0.25em 0.4em;
        font-size: 0.75rem;
    }

    .address-input-group {
        display: flex;
        gap: 30px;
        align-items: center;
        margin-bottom: 10px;
    }

        .address-input-group .mb-3 {
            flex: 1;
            min-width: 0;
        }

    .card-body {
        display: flex;
        flex-direction: column;
        gap: 6px;
        position: relative;
        padding-bottom: 50px;
    }

    .address-info-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 10px;
    }

    .badge-default {
        background-color: #FECC29;
        color: black;
        border-radius: 8px;
        padding: 0.25rem 0.75rem;
        font-size: 0.75rem;
        font-weight: 600;
        text-align: center;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        height: 28px;
        min-width: 70px;
    }

    .address-info-header {
        font-size: 16px;    
    }

    .address-info-body {
        font-size: 15px;
        line-height: 1.6;
        margin-top: 4px;
    }

    .action-buttons {
        position: absolute;
        bottom: 10px;
        right: 15px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .badge-default {
        background-color: #FECC29;
        color: black;
        border-radius: 8px;
        padding: 0.25rem 0.6rem;
        font-size: 0.75rem;
        font-weight: 500;
        align-items: center;
        text-align: center;
    }
    
    .btn-outline-yellow {
        border: 1px solid #FECC29;
        color: #FECC29;
        background-color: white;
        font-weight: 500;
        padding: 0.25rem 0.6rem;
        font-size: 0.8rem;
        border-radius: 6px;
    }

        .btn-outline-yellow:hover {
            background-color: #FECC29;
            color: black;
        }

    .btn-outline-primary,
    .btn-outline-danger {
        font-size: 0.8rem;
        padding: 0.25rem 0.6rem;
    }
/*         .mb-3 label {
            margin-bottom: 7px;
        } */
</style>

<div class="address-layout">
    <div class="page-container">
        <div class="header-row">
            <h1 class="address-title">Địa chỉ của tôi</h1>
        </div>
        <div class="content-wrapper" style="margin-bottom: 40px">
            <!-- Sidebar bên trái -->
            <div class="sidebar-wrapper">
                @Html.Partial("_AccountSidebar")
            </div>
            <div class="address-content">
@*                 <button class="btn btn-add-new-address mb-3" data-bs-toggle="modal" data-bs-target="#addAddressModal">Thêm địa chỉ mới</button>
 *@
                @foreach (var addr in Model)
                {
                    <div class="card mb-3">
                        <div class="card-body">
                            <div class="address-info-header">
                                <div class="info-name-phone">
                                    <strong>@addr.FullName</strong> | @addr.Phone
                                </div>
                                <div>
                                    @if (addr.IsDefault)
                                    {
                                        <span class="badge badge-default">Mặc định</span>
                                    }
                                    else
                                    {
                                        <form asp-action="SetDefaultAddress" method="post" class="d-inline">
                                            @Html.AntiForgeryToken()
                                            <input type="hidden" name="id" value="@addr.AddressId" />
                                            <button type="submit" class="btn btn-sm btn-outline-yellow">Thiết lập mặc định</button>
                                        </form>
                                    }
                                </div>
                            </div>

                            <div class="address-info-body">
                                @addr.SpecificAddress<br />
                                @addr.Ward, @addr.District, @addr.Province<br />
                                <small>Loại địa chỉ: @addr.AddressType</small>
                            </div>


                            <div class="action-buttons">
@*                                 @if (addr.IsDefault)
                                {
                                    <span class="badge badge-default">Mặc định</span>
                                }
                                else
                                {
                                    <form asp-action="SetDefaultAddress" method="post" class="d-inline">
                                        @Html.AntiForgeryToken()
                                        <input type="hidden" name="id" value="@addr.AddressId" />
                                        <button type="submit" class="btn btn-sm btn-outline-secondary">Thiết lập mặc định</button>
                                    </form>
                                } *@

                                <button type="button" class="btn btn-sm btn-outline-primary"
                                        data-bs-toggle="modal"
                                        data-bs-target="#editModal-@addr.AddressId">
                                    Cập nhật
                                </button>

                                <form asp-action="DeleteAddress" method="post" class="d-inline">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="id" value="@addr.AddressId" />
                                    <button type="submit" class="btn btn-sm btn-outline-danger">Xóa</button>
                                </form>
                            </div>
                        </div>

                    </div>

                    <!-- Modal cập nhật -->
                    <div class="modal fade" id="editModal-@addr.AddressId" tabindex="-1" aria-labelledby="editModalLabel-@addr.AddressId" aria-hidden="true">
                        <div class="modal-dialog" style="width: 800px !important">
                            <form asp-action="UpdateAddress" method="post">
                                @Html.AntiForgeryToken()
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="editModalLabel-@addr.AddressId">Cập nhật địa chỉ</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                    </div>
                                    <div class="modal-body">
                                        <input type="hidden" name="AddressId" value="@addr.AddressId" />
                                        <div class="address-input-group">
                                            <div class="mb-3">
                                                <label>Họ tên</label>
                                                <input name="FullName" value="@addr.FullName" class="form-control" required />
                                            </div>
                                            <div class="mb-3">
                                                <label>Số điện thoại</label>
                                                <input name="Phone" value="@addr.Phone" class="form-control" required />
                                            </div>
                                        </div>
                                        <div class="address-input-group">
                                            <div class="mb-3">
                                                <label>Tỉnh/Thành</label>
                                                <input name="Province" value="@addr.Province" class="form-control" required />
                                            </div>
                                            <div class="mb-3">
                                                <label>Quận/Huyện</label>
                                                <input name="District" value="@addr.District" class="form-control" required />
                                            </div>
                                        </div>
                                        <div class="address-input-group">
                                            <div class="mb-3">
                                                <label>Phường/Xã</label>
                                                <input name="Ward" value="@addr.Ward" class="form-control" required />
                                            </div>
                                            <div class="mb-3">
                                                <label>Địa chỉ cụ thể</label>
                                                <input name="SpecificAddress" value="@addr.SpecificAddress" class="form-control" required />
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label>Loại địa chỉ</label>
                                            <select name="AddressType" class="form-select">
                                                <option selected="@("Nhà riêng" == addr.AddressType)">Nhà riêng</option>
                                                <option selected="@("Văn phòng" == addr.AddressType)">Văn phòng</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                                        <button type="submit" class="btn btn-primary">Cập nhật</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                }
                <!-- Di chuyển nút "Thêm địa chỉ mới" xuống dưới đây -->
                <div style="text-align: right;">
                    <button class="btn btn-add-new-address mt-3" data-bs-toggle="modal" data-bs-target="#addAddressModal">
                        Thêm địa chỉ mới
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal thêm địa chỉ mới -->
<div class="modal fade" id="addAddressModal" tabindex="-1" aria-labelledby="addAddressModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <form asp-action="AddAddress" method="post">
            @Html.AntiForgeryToken()
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addAddressModalLabel">Thêm địa chỉ mới</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="address-input-group">
                        <div class="mb-3">
                            <label>Họ tên</label>
                            <input name="FullName" class="form-control" required />
                        </div>
                        <div class="mb-3">
                            <label>Số điện thoại</label>
                            <input name="Phone" class="form-control" required />
                        </div>
                    </div>
                    <div class="address-input-group">
                        <div class="mb-3">
                            <label>Tỉnh/Thành</label>
                            <input name="Province" class="form-control" required />
                        </div>
                        <div class="mb-3">
                            <label>Quận/Huyện</label>
                            <input name="District" class="form-control" required />
                        </div>
                    </div>
                    <div class="address-input-group">
                        <div class="mb-3">
                            <label>Phường/Xã</label>
                            <input name="Ward" class="form-control" required />
                        </div>
                        <div class="mb-3">
                            <label>Địa chỉ cụ thể</label>
                            <input name="SpecificAddress" class="form-control" required />
                        </div>
                    </div>
                    <div class="mb-3">
                        <label>Loại địa chỉ</label>
                        <select name="AddressType" class="form-select">
                            <option>Nhà riêng</option>
                            <option>Văn phòng</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="submit" class="btn btn-primary">Thêm</button>
                </div>
            </div>
        </form>
    </div>
</div>